/*
  filename: angular.integralui.treeview.min.js
  version : 1.0.0
  Copyright © 2014 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui",[]).factory("IntegralUIDragDrop",function(){var a={source:null,target:null,dropPos:-1};return{clearData:function(){a={source:null,target:null,dropPos:-1}},getData:function(){return a},setData:function(h){h&&(h.source&&(a.source=h.source),h.target&&(a.target=h.target),isNaN(h.dropPos)||(a.dropPos=h.dropPos))}}}).factory("IntegralUITreeViewService",["$rootScope",function(a){var h=null;return{addItem:function(d,b,g){a.$broadcast(d+"-add-item",b,g)},clearItems:function(d,b){a.$broadcast(d+"-clear-items",b)},insertItemAt:function(d,b,g,f){a.$broadcast(d+"-insert-item-at",b,g,f)},insertItemBefore:function(d,b,g){a.$broadcast(d+"-insert-item-before",b,g)},insertItemAfter:function(d,b,g){a.$broadcast(d+"-insert-item-after",b,g)},removeItem:function(d,b){a.$broadcast(d+"-remove-item",b)},removeItemAt:function(d,b,g){a.$broadcast(d+"-remove-item-at",b,g)},loadData:function(d,b,g,f){a.$broadcast(d+"-load-data",b,g,f)},collapse:function(d,b){a.$broadcast(d+"-collapse",b)},expand:function(d,b){a.$broadcast(d+"-expand",b)},toggle:function(d,b){a.$broadcast(d+"-toggle",b)},findItemById:function(d,b){a.$broadcast(d+"-find-item-by-id",b);var g=this.getTempData();this.clearTempData();return g?g:null},findItemByText:function(d,b){a.$broadcast(d+"-find-item-by-text",b);var g=this.getTempData();this.clearTempData();return g?g:null},getItemParent:function(d,b){a.$broadcast(d+"-get-item-parent",b);var g=this.getTempData();this.clearTempData();return g?g:null},clearTempData:function(){h=null},ensureVisible:function(d,b){a.$broadcast(d+"-ensure-visible",b)},getTempData:function(){return h},getItemLevel:function(d,b){a.$broadcast(d+"-get-item-level",b);var g=this.getTempData();this.clearTempData();return g?g:0},getFullPath:function(d,b){a.$broadcast(d+"-get-full-path",b);var g=this.getTempData();this.clearTempData();return g?g:""},getList:function(d,b){a.$broadcast(d+"-get-list",b);var g=this.getTempData();this.clearTempData();return g?g:[]},setTempData:function(a){h=a},selectedItem:function(d,b){if(b)a.$broadcast(d+"-set-selected-item",b);else{a.$broadcast(d+"-get-selected-item");var g=this.getTempData();this.clearTempData();return g?g:null}},getScrollPos:function(d){a.$broadcast(d+"-get-scroll-pos");d=this.getTempData();this.clearTempData();return d?d:{x:0,y:0}},setScrollPos:function(d,b){a.$broadcast(d+"-set-scroll-pos",b)}}}]).factory("IntegralUITreeInternalService",["$rootScope",function(a){var h=null;return{callAfterCollapse:function(d,b){a.$broadcast(d+"-call-after-collapse",b)},callAfterExpand:function(d,b){a.$broadcast(d+"-call-after-collapse",b)},callBeforeCollapse:function(d,b){a.$broadcast(d+"-call-before-collapse",b);var g=this.getTempData();this.clearTempData();return void 0!==g?g:!0},callBeforeExpand:function(d,b){a.$broadcast(d+"-call-before-expand",b);var g=this.getTempData();this.clearTempData();return void 0!==g?g:!0},callDragOver:function(d,b,g,f,e,h){a.$broadcast(d+"-call-drag-over",b,g,f,e,h)},callDragDrop:function(d,b,g,f,e,h){a.$broadcast(d+"-call-drag-drop",b,g,f,e,h);d=this.getTempData();this.clearTempData();return void 0!==d?d:!0},callItemClick:function(d,b,g){a.$broadcast(d+"-call-item-click",b,g)},callItemDblClick:function(d,b,g){a.$broadcast(d+"-call-item-dblclick",b,g)},callItemHover:function(d,b){a.$broadcast(d+"-call-item-hover",b)},callItemRightClick:function(d,b,g){a.$broadcast(d+"-call-item-rightclick",b,g)},clearTempData:function(){h=null},drop:function(d,b,g,f){a.$broadcast(d+"-drop",b,g,f)},dropMark:function(d,b){a.$broadcast(d+"-drop-mark",b)},getCurrentSelection:function(d){a.$broadcast(d+"-get-current-selection");d=this.getTempData();this.clearTempData();return d?d:null},getDropPos:function(a,b,g){a={left:g.x,top:g.y+g.height/4,right:g.x+g.width,bottom:g.y+3*g.height/4};if(this.hitTest(b.x,b.y,a))return 0;a.bottom=a.top;a.top=g.y;if(this.hitTest(b.x,b.y,a))return 1;a.top=g.y+3*g.height/4;a.bottom=g.y+g.height;return this.hitTest(b.x,b.y,a)?2:-1},getElement:function(d){a.$broadcast(d+"-get-element");d=this.getTempData();this.clearTempData();return d?d:null},getItemIcon:function(d){a.$broadcast(d+"-get-item-icon");d=this.getTempData();this.clearTempData();return d?d:""},getScrollPos:function(d){a.$broadcast(d+"-get-scroll-pos");d=this.getTempData();this.clearTempData();return d?d:{x:0,y:0}},getTempData:function(){return h},getUniqueId:function(a){function b(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a=a||"-";return b()+b()+a+b()+a+b()+a+b()+a+b()+b()+b()},hitTest:function(a,b,g){return a>=g.left&&a<=g.right&&b>=g.top&&b<=g.bottom?!0:!1},isDragAllowed:function(d){a.$broadcast(d+"-is-drag-allowed");d=this.getTempData();this.clearTempData();return void 0!==d?d:!1},isDropAllowed:function(d,b,g){a.$broadcast(d+"-is-drop-allowed",b,g);d=this.getTempData();this.clearTempData();return void 0!==d?d:!1},isEqual:function(d,b,g){a.$broadcast(d+"-is-equal",b,g);d=this.getTempData();this.clearTempData();return void 0!==d?d:!1},isHoverSelectionEnabled:function(d){a.$broadcast(d+"-is-hover-selection-enabled");d=this.getTempData();this.clearTempData();return void 0!==d?d:!1},isScrollBarVisible:function(d,b){a.$broadcast(d+"-is-scrollbar-visible",b);var g=this.getTempData();this.clearTempData();return void 0!==g?g:!1},remove:function(d,b){a.$broadcast(d+"-remove",b)},setCurrentSelection:function(d,b){a.$broadcast(d+"-set-current-selection",b)},setScrollPos:function(d,b){a.$broadcast(d+"-set-scroll-pos",b)},setTempData:function(a){h=a},updateChildExist:function(d){a.$broadcast(d+"-update-child-exist")},updatePopupWindow:function(d,b){a.$broadcast(d+"-update-popup-window",b)}}}]).controller("IntegralUITreeViewController",["$scope","$element","$window","IntegralUITreeViewService","IntegralUIDragDrop","IntegralUITreeInternalService",function(a,h,d,b,g,f){var e=this,k=angular.element("<div class='i-ui-treeview-drop-marker'><p class='i-ui-treeview-drop-marker-left'></p><p class='i-ui-treeview-drop-marker-middle'></p><p class='i-ui-treeview-drop-marker-right'></p></div>");a.currentSelection=null;var p=angular.isDefined(a.items),n=!1;this.options={allowAnimation:!0,allowDrag:!1,allowDrop:!0,animationSpeed:200,dataFields:{content:"content",dataSource:null,expanded:"expanded",icon:"icon",id:"id",pid:"pid",statusIcon:"statusIcon",text:"text"},hoverSelection:!1,itemIcon:"",pathSeparator:"\\",rtl:!1,selectedIndex:-1,selectedItem:null,showIcons:!0,showStatusIcons:!1};a.$watch("options.allowAnimation",function(c,a){c!==a&&(e.options.allowAnimation=c)});a.$watch("allowAnimation",function(c,a){c!==a&&(e.options.allowAnimation=c)});a.$watch("options.allowDrag",function(c,a){c!==a&&(e.options.allowDrag=c)});a.$watch("allowDrag",function(c,a){c!==a&&(e.options.allowDrag=c)});a.$watch("options.allowDrop",function(c,a){c!==a&&(e.options.allowDrop=c)});a.$watch("allowDrop",function(c,a){c!==a&&(e.options.allowDrop=c)});a.$watch("options.animationSpeed",function(c,a){c!==a&&(e.options.animationSpeed=c)});a.$watch("animationSpeed",function(c,a){c!==a&&(e.options.animationSpeed=c)});a.$watch("options.dataFields",function(c,a){c!==a&&(e.options.dataFields=c,e.UpdateData())});a.$watch("fields",function(c,a){c!==a&&(e.options.dataFields=c,e.UpdateData())});a.$watch("options.hoverSelection",function(c,a){c!==a&&(e.options.hoverSelection=c)});a.$watch("hoverSelection",function(c,a){c!==a&&(e.options.hoverSelection=c)});a.$watch("options.itemIcon",function(c,a){c!==a&&(e.options.itemIcon=c)});a.$watch("itemIcon",function(c,a){c!==a&&(e.options.itemIcon=c)});a.$watch("options.pathSeparator",function(c,a){c!==a&&(e.options.pathSeparator=c)});a.$watch("pathSeparator",function(c,a){c!==a&&(e.options.pathSeparator=c)});a.$watch("options.rtl",function(c,a){c!==a&&(e.options.rtl=c)});a.$watch("rtl",function(c,a){c!==a&&(e.options.rtl=c)});a.$watch("options.showIcons",function(c,a){c!==a&&(e.options.showIcons=c)});a.$watch("showIcons",function(c,a){c!==a&&(e.options.showIcons=c)});a.$watch("options.showStatusIcons",function(c,a){c!==a&&(e.options.showStatusIcons=c)});a.$watch("showStatusIcons",function(c,a){c!==a&&(e.options.showStatusIcons=c)});a.$watch("options.selectedItem",function(c,a){c!==a&&(e.options.selectedItem=c)});a.$watch("selectedItem",function(c,a){c!==a&&(e.options.selectedItem=c)});this.callAfterCollapse=function(c){angular.isDefined(a.events)&&a.events.afterCollapse&&a.events.afterCollapse({item:c});a.afterCollapse({e:{item:c}})};this.callAfterExpand=function(c){angular.isDefined(a.events)&&a.events.afterExpand&&a.events.afterExpand({item:c});a.afterExpand({e:{item:c}})};this.callBeforeCollapse=function(c){var b=!0,b=angular.isDefined(a.events)&&a.events.beforeCollapse?a.events.beforeCollapse({item:c}):a.beforeCollapse({e:{item:c}});f.setTempData(b);return b};this.callBeforeExpand=function(c){var b=!0,b=angular.isDefined(a.events)&&a.events.beforeExpand?a.events.beforeExpand({item:c}):a.beforeExpand({e:{item:c}});f.setTempData(b);return b};this.callDragOver=function(c,b,e,f,d){angular.isDefined(a.events)&&a.events.dragOver&&a.events.dragOver({dragItem:c,targetItem:b,isDropAllowed:e,dropPos:f,mousePos:d});a.dragOver({e:{dragItem:c,targetItem:b,isDropAllowed:e,dropPos:f,mousePos:d}})};this.callDragDrop=function(c,b,e,d,g){var h=!0,h=angular.isDefined(a.events)&&a.events.dragDrop?a.events.dragDrop({dropItem:c,targetItem:b,isDropAllowed:e,dropPos:d,mousePos:g}):a.dragDrop({e:{dropItem:c,targetItem:b,isDropAllowed:e,dropPos:d,mousePos:g}});f.setTempData(h);return h};this.callItemClick=function(c,b){angular.isDefined(a.events)&&a.events.itemClick&&a.events.itemClick({item:c,mousePos:b});a.itemClick({e:{item:c,mousePos:b}})};this.callItemDblClick=function(c,b){angular.isDefined(a.events)&&a.events.itemDblClick&&a.events.itemDblClick({item:c,mousePos:b});a.itemDblclick({e:{item:c,mousePos:b}})};this.callItemHover=function(c){angular.isDefined(a.events)&&a.events.itemHover&&a.events.itemHover({item:c});a.itemHover({e:{item:c}})};this.callItemRightClick=function(c,b){angular.isDefined(a.events)&&a.events.itemRightClick&&a.events.itemRightClick({item:c,mousePos:b});a.itemRightclick({e:{item:c,mousePos:b}})};h.bind("click",function(c){1===c.which&&e.callItemClick(null,{x:c.pageX,y:c.pageY});c.stopPropagation()});h.bind("dblclick",function(c){c.preventDefault();1===c.which&&e.callItemDblClick(null,{x:c.pageX,y:c.pageY});c.stopPropagation()});h.bind("mousedown",function(c){3===c.which&&e.callItemRightClick(null,{x:c.pageX,y:c.pageY});c.stopPropagation()});a.$on(a.name+"-add-item",function(c,a,b){e.insertAt(a,-1,b)});a.$on(a.name+"-clear-items",function(c,a){e.clear(a)});a.$on(a.name+"-insert-item-at",function(c,a,b,d){e.insertAt(a,b,d)});a.$on(a.name+"-insert-item-after",function(c,a,b){e.insertItem(a,b,!0)});a.$on(a.name+"-insert-item-before",function(c,a,b){e.insertItem(a,b,!1)});a.$on(a.name+"-remove-item",function(c,a){e.removeAt(a)});a.$on(a.name+"-remove-item-at",function(c,a,b){e.removeAt(null,a,b)});this.clear=function(c){var b=this.getList(c),e=b.length;b.length=0;0<e&&(angular.isDefined(a.events)&&a.events.clear?a.events.clear({parent:c}):a.clear({e:{parent:c}}))};this.insertAt=function(c,a,b){this.insert(c,a,b,null,!1)};this.insert=function(c,b,e,d,f){p&&(d=!0,d=angular.isDefined(a.events)&&a.events.itemAdding?a.events.itemAdding({item:c}):a.itemAdding({e:{item:c}}),!1!==d&&c&&(c.pid=e?e.id:"",e=this.getList(e),0>b||null===b||void 0===b?e.push(c):(b=Math.max(Math.min(b,e.length),0),e.splice(b,0,c)),c.id||(c.id=this.getUniqueId()),angular.isDefined(a.events)&&a.events.itemAdded?a.events.itemAdded({item:c}):a.itemAdded({e:{item:c}})))};this.insertItem=function(c,a,b){if(p&&c&&a){var e=this.getParent(a),d=this.getList(e),d=this.getIndexOf(a,d);b&&(d+=1);this.insert(c,d,e,a,b)}};this.removeAt=function(c,b,e){this.dropMark();if(p){var d=null;c&&(e=this.getParent(c),d=this.getList(e),b=this.getIndexOf(c,d));if(null===b||void 0===b)return!1;d=this.getList(e);if(0<=b&&b<d.length){c=d[b];var f=!0,f=angular.isDefined(a.events)&&a.events.itemRemoving?a.events.itemRemoving({item:c}):a.itemRemoving({e:{item:c}});!1!==f&&(c.pid="",d.splice(b,1),angular.isDefined(a.events)&&a.events.itemRemoved?a.events.itemRemoved({item:c}):a.itemRemoved({e:{item:c}}),0<d.length?b<d.length?this.setCurrentSelection(d[b]):this.setCurrentSelection(d[d.length-1]):e?this.setCurrentSelection(e):this.setCurrentSelection(null))}}};a.$watch("items",function(){e.updateChildExist()});this.updateChildExist=function(){a.childExist=this.isThereChildItems()};a.$on(a.name+"-load-data",function(c,a,b,d){e.loadData(a,b,d)});this.loadData=function(c,b,d){var f=[],g=[],h=e.options.dataFields;d&&(d.content&&(h.content=d.content),d.expanded&&(h.expanded=d.expanded),d.icon&&(h.icon=d.icon),d.id&&(h.id=d.id),d.pid&&(h.pid=d.pid),d.text&&(h.text=d.text),d.statusIcon&&(h.statusIcon=d.statusIcon));e.clear(b);c&&c.forEach(function(c,a){var b={content:c[h.content],expanded:c[h.expanded],icon:c[h.icon],id:c[h.id],pid:c[h.pid],text:c[h.text],statusIcon:c[h.statusIcon]},d=b.pid;if(null!==f[d]&&void 0!==f[d]){if(null===f[d].items||void 0===f[d].items)f[d].items=[];f[b.id]=b;f[d].items.push(b)}else f[b.id]=b,g.push(b)});f.length=0;if(b)for(b.items=g,c=0;c<b.items.length;c++)b.items[c].pid=b.id;else angular.isDefined(a.items)&&(a.items=g)};this.updateData=function(){this.options.dataFields.dataSource&&this.loadData(this.options.dataFields.dataSource)};angular.element(d).bind("dragenter",function(c){e.dropMark()});angular.element(d).bind("mouseup",function(c){e.dropMark()});h.bind("dragenter",function(c){c.preventDefault();var b=e.getDnDData();b.source||(b.source={text:c.dataTransfer.getData("text")});angular.isDefined(a.events)&&a.events.dragEnter?a.events.dragEnter({dragItem:b.source,mousePos:{x:c.pageX,y:c.pageY}}):a.dragEnter({e:{dragItem:b.source,mousePos:{x:c.pageX,y:c.pageY}}})});h.bind("dragover",function(c){c.preventDefault();c.dataTransfer.dropEffect=e.options.allowDrop?"move":"none";var a=e.getDnDData();a.source||(a.source={text:c.dataTransfer.getData("text")});e.callDragOver(a.source,null,e.options.allowDrop,-1,{x:c.pageX,y:c.pageY});e.dropMark()});h.bind("drop",function(c){c.preventDefault();e.dropMark();var b=e.getDnDData();b.source||(b.source={text:c.dataTransfer.getData("text")});b.source&&!1!==e.callDragDrop(b.source,null,e.options.allowDrop,-1,{x:c.pageX,y:c.pageY})&&(e.drop(b.source),a.$$phase||a.$apply());e.clearDnDData();c.stopPropagation()});this.containsMousePos=function(c,a){return this.hitTest(c,a,{left:0,top:0,right:h[0].clientWidth,bottom:h[0].clientHeight})};h.bind("dragleave",function(c){c.preventDefault();e.dropMark();var b=e.getDnDData();b.source||(b.source={text:c.dataTransfer.getData("text")});angular.isDefined(a.events)&&a.events.dragLeave?a.events.dragLeave({dragItem:b.source,mousePos:{x:c.pageX,y:c.pageY}}):a.dragLeave({e:{dragItem:b.source,mousePos:{x:c.pageX,y:c.pageY}}})});h.bind("dragend",function(c){c.preventDefault();e.dropMark();e.clearDnDData()});h.bind("mouseleave",function(c){c.preventDefault();e.dropMark()});k.bind("dragover",function(c){c.preventDefault();c.dataTransfer.dropEffect=e.options.allowDrop?"move":"none";e.dropMark(!0);c.stopPropagation()});var l=!1;this.isPopupActive=function(){return l};k.bind("dragenter",function(c){c.preventDefault();l=!0;c.stopPropagation()});k.bind("dragleave",function(c){c.preventDefault();l=!1;e.dropMark(e.containsMousePos(c.offsetX,c.offsetY));c.stopPropagation()});k.bind("drop",function(c){c.preventDefault();e.dropMark();var b=e.getDnDData();b.source||(b.source={text:c.dataTransfer.getData("text")});b.source&&(e.drop(b.source,b.target,b.dropPos),a.$$phase||a.$apply());c.stopPropagation()});this.drop=function(c,a,b){c&&(void 0!==c.remove&&c.remove(),0===b?this.insertAt(c,-1,a):1===b||2===b?1===b?this.insertItem(c,a,!1):this.insertItem(c,a,!0):this.insertAt(c),this.setCurrentSelection(c))};this.hitTest=function(c,a,b){return c>=b.left&&c<=b.right&&a>=b.top&&a<=b.bottom?!0:!1};this.getDropPos=function(c,a){var b={left:a.x,top:a.y+a.height/4,right:a.x+a.width,bottom:a.y+3*a.height/4};if(this.hitTest(c.x,c.y,b))return 0;b.bottom=b.top;b.top=a.y;if(this.hitTest(c.x,c.y,b))return 1;b.top=a.y+3*a.height/4;b.bottom=a.y+a.height;return this.hitTest(c.x,c.y,b)?2:-1};this.isDragAllowed=function(){return this.options.allowDrag};this.isDropAllowed=function(c,a){if(c&&a){if(this.isEqual(c,a))return!1;for(var b=this.getParent(a);null!=b;){if(this.isEqual(c,b))return!1;b=this.getParent(b)}}return this.options.allowDrop};this.clearDnDData=function(){return g.clearData()};this.getDnDData=function(){return g.getData()};this.setDnDData=function(c){return g.setData(c)};this.getPopupWindow=function(){return k};this.dropMark=function(c){this.options.allowDrag&&this.options.allowDrop?angular.element(k).css("display",c?"block":"none"):angular.element(k).css("display","none")};this.updatePopupWindow=function(c){k&&c&&(k.css("top",c.top),k.css("left",c.left+"px"),k.css("width",c.width+"px"))};this.changeExpanded=function(c,a){c&&(c.expanded=a?a:c.expanded?!c.expanded:!1)};this.toggle=function(c,a,b){if(c)this.changeExpanded(c,b);else if(a){n=!0;for(c=0;c<a.length;c++)this.toggle(null,a[c].items,b),this.changeExpanded(a[c],b);n=this.options.allowAnimation}};a.$on(a.name+"-collapse",function(c,b){e.toggle(b,a.items,!1)});a.$on(a.name+"-expand",function(c,b){e.toggle(b,a.items,!0)});a.$on(a.name+"-toggle",function(c,b){e.toggle(b,a.items)});this.ensureVisible=function(c){if(c){n=!0;for(var b=[],d=this.getParent(c);d;)b.push(d),d=this.getParent(d);for(d=b.length-1;0<=d;d--)this.toggle(b[d],null,!0);n=this.options.allowAnimation;a.$broadcast(c.id+"-scroll-to")}};this.findItemById=function(c){return c?this.searchItem(a.items,c):null};this.findItemByText=function(c){return this.searchItem(a.items,c,"text")};this.findParent=function(c,a){var b=null;if(c&&a)for(var d=0;!b&&d<a.length;)b=a[d].id&&c.pid&&a[d].id.toString()===c.pid.toString()?a[d]:this.findParent(c,a[d].items),d++;return b};this.getParent=function(c){return c?this.findParent(c,a.items):null};this.getList=function(c){return c?(c.items||(c.items=[]),c.items):a.items};this.getIndexOf=function(a,b){if(a&&b)for(var d=0;d<b.length;d++)if(b[d].id&&a.id&&b[d].id.toString()===a.id.toString())return d;return-1};this.searchItem=function(a,b,d){var e=null;if(a&&b)for(var f=0,g=!1;!e&&f<a.length;){switch(d){case "text":g=a[f].text===b;break;default:a[f].id&&(g=a[f].id.toString()===b.toString())}e=g?a[f]:this.searchItem(a[f].items,b,d);f++}return e};this.getElemWidth=function(){return h[0].clientWidth-2};this.getElement=function(){return h};this.getFullPath=function(a){var b="";if(a)for(b=a.text,a=this.getParent(a);a;)b=[a.text,this.pathSeparator,b].join(""),a=this.getParent(a);return b};this.getItemIcon=function(){return this.options.itemIcon};this.getLevel=function(a){var b=0;for(a=this.getParent(a);a;)b++,a=this.getParent(a);return b};this.getShowIcons=function(){return this.options.showIcons};this.getShowStatusIcons=function(){return this.options.showStatusIcons};this.getUniqueId=function(a){function b(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a=a||"-";return b()+b()+a+b()+a+b()+a+b()+a+b()+b()+b()};this.isAnimationAllowed=function(){return n};this.isEqual=function(a,b){return a&&b&&a.id&&b.id?a.id.toString()===b.id.toString():!1};this.isLayoutRTL=function(){return this.options.rtl};this.isThereChildItems=function(){if(a.items)for(var b=0;b<a.items.length;b++)if(a.items[b].items&&0<a.items[b].items.length)return!0;return!1};a.$on(a.name+"-ensure-visible",function(a,b){e.ensureVisible(b)});a.$on(a.name+"-find-item-by-id",function(a,d){b.setTempData(e.findItemById(d))});a.$on(a.name+"-find-item-by-text",function(a,d){b.setTempData(e.findItemByText(d))});a.$on(a.name+"-get-full-path",function(a,d){b.setTempData(e.getFullPath(d))});a.$on(a.name+"-get-item-level",function(a,d){b.setTempData(e.getLevel(d))});a.$on(a.name+"-get-item-parent",function(a,d){b.setTempData(e.getParent(d))});a.$on(a.name+"-get-list",function(a,d){b.setTempData(e.getList(d))});h.bind("scroll",function(a){e.setScrollPos({x:h[0].scrollLeft,y:h[0].scrollTop})});var q={x:0,y:0};this.getScrollPos=function(){return q={x:h[0].scrollLeft,y:h[0].scrollTop}};this.isScrollBarVisible=function(a){switch(a){case "horizontal":if(h[0].clientWidth<h[0].scrollWidth)return!0;break;case "vertical":if(h[0].clientHeight<h[0].scrollHeight)return!0;break;default:if(h[0].clientWidth<h[0].scrollWidth||h[0].clientHeight<h[0].scrollHeight)return!0}return!1};this.setScrollPos=function(b){b&&(h[0].scrollLeft!==b.x&&(h[0].scrollLeft=b.x),h[0].scrollTop!==b.y&&(h[0].scrollTop=b.y),q={x:h[0].scrollLeft,y:h[0].scrollTop},angular.isDefined(a.events)&&a.events.scrollPosChanged?a.events.scrollPosChanged({scrollPos:q}):a.scrollposChanged({e:{scrollPos:q}}))};a.$on(a.name+"-get-scroll-pos",function(a){b.setTempData(e.getScrollPos())});a.$on(a.name+"-set-scroll-pos",function(a,b){e.setScrollPos(b)});this.callAfterSelect=function(b){angular.isDefined(a.events)&&a.events.afterSelect?a.events.afterSelect({item:b}):a.afterSelect({e:{item:b}});angular.isDefined(a.events)&&a.events.selectionChanged?a.events.selectionChanged({item:b}):a.selectionChanged({e:{item:b}})};a.$on(a.name+"-get-selected-item",function(a){b.setTempData(e.options.selectedItem)});a.$on(a.name+"-set-selected-item",function(a,b){e.setCurrentSelection(b)});a.$watch("selectedItem",function(a,b){a!==b&&(b&&(b.selected=!1),e.options.selectedItem=a,e.callAfterSelect(a))});this.getCurrentSelection=function(){return this.options.selectedItem};this.isHoverSelectionEnabled=function(){return angular.isDefined(a.hoverSelection)?a.hoverSelection:!1};this.setCurrentSelection=function(b){var d=this.getCurrentSelection();if(!this.isEqual(d,b)){var e=!0,e=angular.isDefined(a.events)&&a.events.beforeSelect?a.events.beforeSelect({item:b}):a.beforeSelect({e:{item:b}});!1!==e&&(d&&(d.selected=!1),this.options.selectedItem=b)&&(this.options.selectedItem.selected=!0,angular.isDefined(a.selectedItem)&&(a.selectedItem=b),this.callAfterSelect(b))}}}]).directive("integraluiTreeview",["$timeout","$interval","IntegralUITreeInternalService",function(a,h,d){return{restrict:"EA",controller:"IntegralUITreeViewController",transclude:!1,replace:!0,template:'<div class="i-ui-treeview" ng-model="treeTestID"><ul ng-class="getBlockClass()"><integralui-treeview-item tree-id="id" ng-repeat="item in items" content="item.content" text="{{item.text}}" items="item.items" expanded="item.expanded" selected="item.selected" icon="item.icon" status-icon="item.statusIcon" id="item.id" pid="item.pid" child-exist="childExist" rtl="rtl" show-icon="showIcons" show-status-icon="showStatusIcons"></integralui-treeview-item></ul></div>',scope:{allowAnimation:"=",allowDrag:"=",allowDrop:"=",animationSpeed:"=",fields:"=",hoverSelection:"=",itemIcon:"=",items:"=",name:"@",options:"=?",pathSeparator:"@",rtl:"=",selectedIndex:"=",selectedItem:"=",showIcons:"=",showStatusIcons:"=",afterCollapse:"&",afterExpand:"&",afterSelect:"&",beforeCollapse:"&",beforeExpand:"&",beforeSelect:"&",clear:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",events:"=?",itemAdded:"&",itemAdding:"&",itemClick:"&",itemDblclick:"&",itemHover:"&",itemRemoved:"&",itemRemoving:"&",itemRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(b,g,f,e){b.id||(b.id=e.getUniqueId());angular.isDefined(b.options)?(e.options=b.options,e.updateData()):(!1===b.allowAnimation&&(e.options.allowAnimation=b.allowAnimation),!0===b.allowDrag&&(e.options.allowDrag=b.allowDrag),!1===b.allowDrop&&(e.options.allowDrop=b.allowDrop),angular.isDefined(b.animationSpeed)&&200!==b.animationSpeed&&(e.options.animationSpeed=b.animationSpeed),angular.isDefined(b.fields)&&(e.options.dataFields=b.fields,e.updateData()),!0===b.hoverSelection&&(e.options.hoverSelection=b.hoverSelection),angular.isDefined(b.itemIcon)&&(e.options.itemIcon=b.itemIcon),!0===b.rtl&&(e.options.rtl=b.rtl),angular.isDefined(b.selectedIndex)&&(e.options.selectedIndex=b.selectedIndex),angular.isDefined(b.selectedItem)&&(e.options.selectedItem=b.selectedItem),!1===b.showIcons&&(e.options.showIcons=b.showIcons),!0===b.showStatusIcons&&(e.options.showStatusIcons=b.showStatusIcons));b.getBlockClass=function(){var a="i-ui-treeview-block";e.options.showStatusIcons&&(a+=" "+a+"-shift-left");e.options.rtl&&(a+=" "+a+"-rtl");return a};angular.isDefined(b.selectedItem)&&e.setCurrentSelection(b.selectedItem);b.$on(b.id+"-call-after-collapse",function(a,b){e.callAfterCollapse(b)});b.$on(b.id+"-call-after-expand",function(a,b){e.callAfterExpand(b)});b.$on(b.id+"-call-before-collapse",function(a,b){e.callBeforeCollapse(b)});b.$on(b.id+"-call-before-expand",function(a,b){e.callBeforeExpand(b)});b.$on(b.id+"-call-drag-over",function(a,b,d,f,c,g){e.callDragOver(b,d,f,c,g)});b.$on(b.id+"-call-drag-drop",function(a,b,d,f,c,g){e.callDragDrop(b,d,f,c,g)});b.$on(b.id+"-call-item-click",function(a,b,d){e.callItemClick(b,d)});b.$on(b.id+"-call-item-dblclick",function(a,b,d){e.callItemDblClick(b,d)});b.$on(b.id+"-call-item-hover",function(a,b){e.callItemHover(b)});b.$on(b.id+"-call-item-rightclick",function(a,b,d){e.callItemRightClick(b,d)});b.$on(b.id+"-drop",function(a,b,d,f){e.drop(b,d,f)});b.$on(b.id+"-drop-mark",function(b,a){e.dropMark(a)});b.$on(b.id+"-get-current-selection",function(a){d.setTempData(e.getCurrentSelection())});b.$on(b.id+"-get-element",function(a){d.setTempData(e.getElement())});b.$on(b.id+"-get-item-icon",function(a){d.setTempData(e.getItemIcon())});b.$on(b.id+"-get-scroll-pos",function(a){d.setTempData(e.getScrollPos())});b.$on(b.id+"-is-drag-allowed",function(a){d.setTempData(e.isDragAllowed())});b.$on(b.id+"-is-drop-allowed",function(a,b,f){d.setTempData(e.isDropAllowed(b,f))});b.$on(b.id+"-is-equal",function(a,b,f){d.setTempData(e.isEqual(b,f))});b.$on(b.id+"-is-hover-selection-enabled",function(a){d.setTempData(e.isHoverSelectionEnabled())});b.$on(b.id+"-is-scrollbar-visible",function(a,b){d.setTempData(e.isScrollBarVisible(b))});b.$on(b.id+"-remove",function(a,b){e.removeAt(b)});b.$on(b.id+"-set-current-selection",function(a,b){e.setCurrentSelection(b)});b.$on(b.id+"-set-scroll-pos",function(a,b){e.setScrollPos(b)});b.$on(b.id+"-update-child-exist",function(a){e.updateChildExist()});b.$on(b.id+"-update-popup-window",function(a,b){e.updatePopupWindow(b)});g.append(e.getPopupWindow());e.dropMark();var k=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",g[0].scrollTop+"px"),this.$tw.css("left",g[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",g[0].scrollTop+"px"),this.$tw.css("left",g[0].scrollLeft+"px"))};this.s1t=function(b){this.trlTime=a(function(){k.trActive||(k.trCount=0,k.trActive=!0,k.trId=h(function(){k.animTr()},1E3))},b)};this.s2t=function(){this.trId&&(h.clear(this.trId),this.trId=null);this.trlTime&&(a.clear(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};g.append(this.$tw);this.s1t(this.twp);b.$on("destroy",function(b){k.s2t()})}}}]).directive("integraluiTreeviewItem",["$compile","$timeout","$interval","IntegralUITreeInternalService","IntegralUIDragDrop",function(a,h,d,b,g){return{restrict:"EA",replace:!0,scope:{childExist:"=",content:"=?",expanded:"=?",icon:"=?",id:"=?",items:"=?",pid:"=?",rtl:"=",selected:"=",showIcon:"=",showStatusIcon:"=",statusIcon:"=?",text:"@",treeId:"="},template:'<li class="i-ui-treeview-item"><span ng-class="getStatusIconClass()" ng-show="toggleStatusIcon()"></span><span ng-class="getExpandBoxClass()"  ng-click="toggle()"></span><span ng-class="getIconClass()" ng-show="toggleIcon()"></span><span ng-class="getItemClass()" ng-click="select()" ng-mouseenter="mouseEnter()" ng-mouseleave="mouseLeave()">{{text}}</span></li>',link:function(f,e,k){f.$watch("content",function(b,a){b!==a&&t()});f.$watch("items",function(){b.updateChildExist(f.treeId)});f.toggleText=function(){return f.content?!1:!0};var p=null,n=!1,l=null,q=!1,c=0,s=null,m=e.find("span").eq(3);m.attr("draggable",!0);var t=function(){if(angular.isDefined(f.content)){var b=e.children().eq(4);b&&0<b.length&&b[0].remove();f.content&&e.append(a('<div ng-class="getItemClass()" ng-click="select()" ng-mouseenter="mouseEnter()" ng-mouseleave="mouseLeave()">'+f.content+"</div>")(f))}!1!==f.expanded?(b=angular.element('<ul ng-class="getBlockClass()" ng-show="expanded !== false"><integralui-treeview-item tree-id="treeId" ng-repeat="item in items" content="item.content" text="{{item.text}}" items="item.items" expanded="item.expanded" selected="item.selected" icon="item.icon" status-icon="item.statusIcon" id="item.id" pid="item.pid" child-exist="childExist" rtl="rtl" show-icon="showIcon" show-status-icon="showStatusIcon"></integralui-treeview-item></ul>'),e.append(a(b)(f))):(b=e.find("ul"))&&0<b.length&&b.remove()};f.getBlockClass=function(){var b="i-ui-treeview-item-block";!0===f.rtl&&(b+="-rtl");return b};f.getExpandBoxClass=function(){var b="";!1!==f.childExist&&(b="i-ui-treeview-expand-box");f.items&&0<f.items.length&&(b=!1!==f.expanded?b+(" "+b+"-close"):b+(" "+b+"-open"),!0===f.rtl&&(b+="-rtl"));return b};f.getIconClass=function(){return f.icon};f.getItemClass=function(){var b="i-ui-treeview-item-content";f.selected?b+=" "+b+"-selected":n&&(b+=" "+b+"-hovered");return b};f.getStatusIconClass=function(){var b;return b="i-ui-treeview-status-icon "+f.statusIcon};f.id||(f.id=b.getUniqueId());if(f.items&&0<f.items.length)for(k=0;k<f.items.length;k++)f.items[k].pid||(f.items[k].pid=f.id);void 0===f.expanded&&(f.expanded=!0);f.icon||(f.icon=b.getItemIcon(f.treeId));t();f.remove=function(){b.remove(f.treeId,f);f.pid=""};e.bind("dragover",function(a){a.preventDefault();var c=b.getDropPos(f.treeId,{x:a.offsetX,y:a.offsetY},{x:0,y:0,width:e[0].offsetWidth,height:m[0].offsetHeight}),d=g.getData().source,h=b.isDropAllowed(f.treeId,d,f);b.callDragOver(f.treeId,d,f,h,c,{x:a.pageX,y:a.pageY});if(h){var k=e[0].offsetTop-3+"px";2===c&&(k=e[0].offsetTop+e[0].offsetHeight-2+"px");if(1===c||2===c){var l=b.getElement(f.treeId);l&&(!0===f.rtl?b.updatePopupWindow(f.treeId,{top:k,left:2,width:m[0].offsetLeft+m[0].clientWidth-2}):b.updatePopupWindow(f.treeId,{top:k,left:m[0].offsetLeft,width:l[0].clientWidth-2-m[0].offsetLeft+l[0].scrollLeft}),b.dropMark(f.treeId,h))}else b.dropMark(f.treeId);g.setData({source:d,target:f,dropPos:c});c=e[0].offsetTop-b.getScrollPos(f.treeId).y+a.offsetY;b.isScrollBarVisible(f.treeId)?(d=b.getElement(f.treeId))?10>c?v(!1):c>d[0].clientHeight-15?v(!0):r():r():r()}else a.dataTransfer.dropEffect="none",b.dropMark(f.treeId);a.stopPropagation()});e.bind("drop",function(a){a.preventDefault();u();f.expand();b.dropMark(f.treeId);var c=g.getData(),d=c.source;d||(d={text:a.dataTransfer.getData("text")});if(d){var e=b.isDropAllowed(f.treeId,d,f);!1!==b.callDragDrop(f.treeId,d,f,e,c.dropPos,{x:a.pageX,y:a.pageY})&&(b.drop(f.treeId,d,f,c.dropPos),f.$$phase||f.$apply())}g.clearData();a.stopPropagation()});var u=function(){p&&(h.cancel(p),p=null)};e.bind("dragenter",function(b){b.preventDefault();p=h(function(){f.expand()},750);b.stopPropagation()});e.bind("dragleave",function(b){b.preventDefault();u();b.stopPropagation()});m.bind("dragstart",function(a){b.isDragAllowed(f.treeId)?(a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text",f.id),g.setData({source:f})):a.dataTransfer.effectAllowed="none"});e.bind("dragend",function(a){a.preventDefault();b.dropMark(f.treeId);g.clearData();a.stopPropagation()});m.bind("click",function(a){1===a.which&&b.callItemClick(f.treeId,f,{x:a.pageX,y:a.pageY});a.stopPropagation()});m.bind("dblclick",function(a){a.preventDefault();1===a.which&&(b.callItemDblClick(f.treeId,f,{x:a.pageX,y:a.pageY}),f.toggle(),f.$$phase||f.$apply());a.stopPropagation()});m.bind("mousedown",function(a){3===a.which&&b.callItemRightClick(f.treeId,f,{x:a.pageX,y:a.pageY});a.stopPropagation()});f.$watch("expanded",function(b,a){b!==a&&t()});f.expand=function(){if(!f.items||0===f.items.length)return!1;!1===f.expanded&&!1!==b.callBeforeExpand(f.treeId,f)&&(f.expanded=!0,b.callAfterExpand(f.treeId,f))};f.toggle=function(){if(!f.items||0===f.items.length)return!1;var a=!1!==f.expanded?!0:!1,c=!0,c=a?b.callBeforeCollapse(f.treeId,f):b.callBeforeExpand(f.treeId,f);!1!==c&&(f.expanded=!a,f.expanded?b.callAfterExpand(f.treeId,f):b.callAfterCollapse(f.treeId,f))};f.mouseEnter=function(){n=!0;b.callItemHover(f.treeId,f);b.isHoverSelectionEnabled(f.treeId)&&(l=h(function(){f.select()},500))};f.mouseLeave=function(){l&&(h.cancel(l),l=null);n=!1};f.toggleIcon=function(){return!1!==f.showIcon?!0:!1};f.toggleStatusIcon=function(){return!1!==f.showStatusIcon?!0:!1};f.$on(f.id+"-scroll-to",function(a){a=b.getElement(f.treeId);b.setScrollPos(f.treeId,{x:e[0].offsetLeft+a[0].scrollLeft-a[0].offsetWidth/2,y:e[0].offsetTop+a[0].scrollTop-(a[0].offsetHeight-e[0].offsetHeight)/2})});var v=function(a){q||(c=0,q=!0,s=d(function(){var d=b.getScrollPos(f.treeId);0===c&&(c=5);c+=10;d.y=a?d.y+c:d.y-c;b.setScrollPos(f.treeId,d);(0>=d.y||b.getScrollPos(f.treeId).y<d.y)&&r()},100))},r=function(){s&&(d.cancel(s),s=null);q=!1;c=0};f.select=function(){b.setCurrentSelection(f.treeId,f)};f.$on("destroy",function(a){u();l&&(h.cancel(l),l=null);r()})}}}]);